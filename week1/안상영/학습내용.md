# 토비의 스프링 3.1  
## 이일민 지음  
  
  
## 1장 오브젝트와 의존관계  
### 1.1 초난감 DAO  
DAO(Data Access Object)는 DB를 사용해 데이터를 조회하거나 조작하는 기능을 전담하도록 만든 오브젝트.  
  
#### 1.1.1 User  
자바빈은 원래 비주얼 툴에서 조작 가능한 컴포넌트를 말한다.  
간단히 빈이라고 부르기도 하며, 이제는 다음 두 가지 관례를 따라 만들어진 오브젝트를 가리킨다.  
-디폴트 생성자: 자바빈은 파라미터가 없는 디폴트 생성자를 갖고 있어야 한다.  
툴이나 프레임워크에서 리플렉션을 이용해 오브젝트를 생성하기 때문에 필요하다.  
(리플렉션은 힙 영역에 로드 된 Class 타입의 객체를 통해, 접근 제어자 상관없이 원하는 클래스의 정보에 접근해서 조작할 수 있도록 지원하는 API이다.)  
-프로퍼티: 자바빈이 노출하는 이름을 가진 속성을 프로퍼티라고 한다.  
set으로 시작하는 수정자 메소드와 get으로 시작하는 접근자 메소드를 이용해 수정 또는 조회할 수 있다.  
  
#### 1.1.2 UserDao  
JDBC API가 만들어내는 예외를 잡아서 직접 처리하거나, 메소드에 throws를 선언해서 예외가 발생하면 메소드 밖으로 던지게 한다.  
일단 예외는 모두 메소드 밖으로 던져버리는 편이 간단한다.  
  
#### 1.1.3 main()을 이용한 DAO 테스트 코드  
스프링은 좋은 결론을 내릴 수 있도록 객체지향 기술과 자바 개발의 선구자들이 먼저 고민하고 제안한 방법에 대한 힌트를 제공해줄 뿐이다.  
  
  
### 1.2 DAO의 분리  
#### 1.2.1 관삼사의 분리  
프로그래밍 기초 개념 중에 관심사의 분리라는게 있다.  
이를 객체지향에 적용해보면, 관심이 같은 것끼리는 하나의 객체 안으로 또는 친한 객체로 모이게 하고,  
관심이 다른 것은 가능한 한 따로 떨어져서 서로 영향을 주지 않도록 분리하는 것이라고 생각할 수 있다.  
  
#### 1.2.2 커넥션 만들기의 추출  
리팩토링은 기존의 코드를 외부의 동작방식에는 변화 없이 내부 구조를 변경해서 재구성하는 작업 또는 기술을 말한다.  
  
#### 1.2.3 DB 커넥션 만들기의 독립  
슈퍼 클래스에 기본적인 로직의 흐름을 만들고, 그 기능의 일부를 추상 메소드나 오버라이딩이 가능한 protected 메소드 등으로 만든 뒤  
서브클래스에서 이런 메소드를 필요에 맞게 구현해서 사용하도록 하는 방법을 "템플릿 메소드 패턴"이라고 한다.  
  
서브클래스에서 구체적인 오브젝트 생성 방법을 결정하게 하는 것을 "팩토리 메소드 패턴"이라고 부르기도 한다.  
  
단점  
-이미 UserDao가 다른 목적을 위해 상속을 사용하고 있을 수 있다.(자바는 클래스의 다중상속을 허용하지 않는다.)  
-또는 후에 다른 목적으로 UserDao에 상속을 적용하기 힘들다.  
-상속을 통한 상하위 클래스의 관계는 생각보다 밀접하다.  
-이에 따라 슈퍼클래스 내부의 변경이 있을 때 모든 서브클래스를 함께 수정하거나 다시 개발해야할 수도 있다.  
-반대로 그런 변화에 따른 불편을 주지 않기 위해 슈퍼클래스가 더 이상 변화하지 않도록 제약을 가해야 할수도 있다.  
-확장된 기능인 DB 커넥션을 생성하는 코드를 다른 DAO 클래스에 적용할 수 없다는 것도 큰 단점이다.  
  
  
### 1.3 DAO의 확장  
추상 클래스를 만들고 이를 상속한 서브클래스에서 변화가 필요한 부분을 바꿔서 쓸 수 있게 만든 이유는  
변화의 성격이 다른 것을 분리해서, 서료 영향을 주지 않은 채로 각각 필요한 시점에 독립적으로 변경할 수 있게 하기 위해서다.  
  
#### 1.3.1 클래스의 분리  
각 메소드에서 매번 SimpleConnectionMaker의 오브젝트를 만들 수도 있지만,  
그보다는 한 번만 SimpleConnectionMaker 오브젝트를 만들어서 저쟁해두고 이를 계속 사용하는 편이 낫다.  
(상태를 관리하는 것도 아니니 한번만 만들어 인스턴스 변수에 저장해두고 메소드에서 사용하게 한다.  
```  
public class UserDao {  
    private SimpleConnectionMaker simpleConnectionMaker;  
    
    public UserDao() {  
        simpleConnectionMaker = new SimpleConnectionMaker();  
    }  
```  
  
단점  
-UserDao 코드의 수정 없이 DB 커넥션 생성 기능을 변경할 방법이 없다.  
  
#### 1.3.2 인터페이스의 도입  
추상화란 어떤 것들의 공통적인 성격을 뽑아내어 이를 따로 분리해내는 작업이다.  
자바가 추상화를 위해 제공하는 가장 유용한 도구는 바로 인터페이스다.  
  
단점  
-초기에 한 번 어떤 클래스의 오브젝트를 사용할지를 결정하는 생성자의 코드는 제거되지 않고 남아 있다.  
  
#### 1.3.3 관계설정 책임의 분리  
코드에서는  특정 클래스를 전혀 알지 못하더라도 해당 클래스가 구현한 인터페이스를 사용했다면,  
그 클래스의 오브젝트를 인터페이스 타입으로 받아서 사용할 수 있다.  
바로 객체지향 프로그램에는 다형성이라는 특징이 있는 덕분이다.  
  
인터페이스를 도입하고 클라이언트의 도움을 얻는 방법은 상속을 사용해 비슷한 시도를 했을 경우에 비해서 훨씬 유연하다.  
  
#### 1.3.4 원칙과 패턴  
개방 폐쇄 원칙  
클래스나 모듈은 확장에는 열려 있어야 하고 변경에는 닫혀 있어야 한다.  
-UserDao는 DB 연결 방법이라는 기능을 확장하는 데는 열려 있다.  
-UserDao에 전혀 영향을 주지 않고도 얼마든지 기능을 확장할 수 있게 되어 있다.  
동시에 UserDao 자신의 핵심 기능을 구현한 코드는 그런 변화에 영향을 받지 않고 유지할 수 있으므로  
변경에는 닫혀 있다고 말할 수 있다.  
  
전략패턴  
자신의 기능 맥락에서, 필요에 따라 변경이 필요한 알고리즘을 인터페이스를 통해 통째로 외부로 분리시키고,  
이를 구현한 구체적인 알고리즘 클래스를 필요에 따라 바꿔서 사용할 수 있게 하는 디자인 패턴.  
(대체 가능한 전략이라고 보기 때문에 패턴의 이름이 전략 패턴이다.)  
  
  
### 1.4 제어의 역전(IoC)  
#### 1.4.1 오브젝트 팩토리  
객체의 생성 방법을 결정하고 그렇게 만들어진 오브젝트를 돌려주는 역할을 하는 오브젝트를 흔히 팩토리라고 부른다.  
  
#### 1.4.2 오브젝트 팩토리의 활용  
#### 1.4.3 제어권의 이전을 통한 제어관계 역전  
제어의 역전이라는 건, 간단히 프로그램의 제어 흐름 구조가 뒤바뀌는 것이라고 설명할 수 있다.  
프로그램의 시작을 담당하는 main()과 같은 엔트리 포인트를 제외하면,  
모든 오브젝트는 이렇게 위임받은 제어 권한을 갖는 특별한 오브젝트에 의해 결정되고 만들어진다.  
  
  
### 1.5 스프링의 IoC  
스프링의 핵심을 담당하는 건, 바로 빈 팩토리 또는 애플리케이션 컨텍스트라고 불리는 것이다.  
이 두가지는 우리가 만든 DaoFactory가 하는 일을 좀 더 일반화한 것이라고 설명할 수 있다.  
  
#### 1.5.1 오브젝트 팩토리를 이용한 스프링 IoC  
스프링에서는 제어권을 가지고 직접 만들고 관계를 부여하는 오브젝트를 빈이라고 부른다.  
자바빈 또는 엔터프라이즈 자바빈(EJB)에서 말하는 빈과 비슷한 오브젝트 단위의 애플리케이션 컴포넌트를 말한다.  
동시에 스프링 빈은 스프링 컨테이너가 생성과 관계설정, 사용 등을 제어해주는 제어의 역전이 적용된 오브젝트를 가리키는 말이다.  
  
스프링에서는 빈의 생성과 관계설정 같은 제어를 담당하는 IoC 오브젝트를 빈 팩토리 또는 애플리케이션 컨텍스트라고 부른다.  
  
-@Configuration: 애플리케이션 컨텍스트 또는 빈 팩토리가 사용할 설정정보라는 표시  
-@Bean: 오브젝트 생성을 담당하는 IoC용 메소드라는 표시  
  
getBean() 메소드는 ApplicationContext가 관리하는 오브젝트를 요청하는 메소드다.  
  
#### 1.5.2 애플리케이션 컨텍스트의 동작방식  
오브젝트 팩토리에 대응되는 것이 스프링의 애플리케이션 컨텍스트다.  
스프링에서는 이 애플리케이션 컨텍스트를 IoC 컨테이너라 하기도 하고,  
간단히 스프링 컨테이너라고 부르기도 한다.  
또는 빈 팩토리라고 부를 수도 있다.  
  
애플리케이션 컨텍스트가 스프링의 가장 대표적인 오브젝트이므로,  
애플리케이션 컨텍스트를 그냥 스프링이라고 부르는 개발자도 있다.  
  
애플리케이션 컨텍스트는 DaoFactory 클래스를 설정정보로 등록해두고 @Bean이 붙은 메소드의 이름을 가져와 빈 목록을 만들어둔다.  
클라이언트가 애플리케이션 컨텍스트의 getBean() 메소드를 호출하면 자신의 빈 목록에서 요청한 이름이 있는지 찾고,  
있다면 빈을 생성하는 메소드를 호출해서 오브젝트를 생성시킨 후 클라이언트에 돌려준다.  
  
#### 1.5.3 스프링 IoC의 용어 정리  
빈:  
빈 또는 빈 오브젝트는 스프링이 IoC 방식으로 관리하는 오브젝트라는 뜻이다.  
스프링이 직접 그 생성과 제어를 담당하는 오브젝트만을 빈이라고 부른다.  
  
빈 팩토리:  
스프링의 IoC를 담당하는 핵심 컨테이너.  
보통은 빈 팩토리를 바로 사용하지 않고 이를 확장한  애플리케이션 컨텍스트를 이용한다.  
  
애플리케이션 컨텍스트:  
빈 팩토리르 확장한 IoC 컨테이너.  
  
컨테이너 또는 IoC 컨테이너:  
IoC 방식으로 빈을 관리한다는 의미에서 애플리케이션 컨텍스트나 빈 팩토리를 컨테이너 또는 IoC 컨테이너라고도 한다.  
  
  
### 1.6 싱글톤 레지스트리와 오브젝트 스코프  
스프링은 여러 번에 걸쳐 빈을 요청하더라도 매번 동일한 오브젝트를 돌려준다는 것이다.  
단순하게 getBean()을 실행할 때마다 userDao()를 호출하고, 매번 new에 의해 새로운 UserDao가 만들어지지 않는다.  
  
#### 1.6.1 싱글톤 레지스트리로서의 애플리케이션 컨텍스트  
애플리케이션 컨텍스트는 싱글톤을 저장하고 관리하는 싱글톤 레지스트리이기도 하다.  
스프링은 기본적으로 별다른 설정을 하지 않으면 내부에서 생성하는 빈 오브젝트를 모두 싱글톤으로 만든다.  
  
서블릿은 대부분 멀티스레드 환경에서 싱글톤으로 동작한다.  
서블릿 클래스당 하나의 오브젝트만 만들어두고, 사용자의 요청을 담당하는 여러 스레드에서 하나의 오브젝트를 공유해 동시에 사용한다.  
  
싱글톤 패턴 구현 방식 단점  
-private 생성자를 갖고 있기 때문에 상속할 수 없다.  
-싱글톤은 만들어지는 방식이 제한적이기 때뭄ㄴ에 테스트에서 사용될 때 목 오브젝트 등으로 대체하기가 힘들다.  
-서버환경에서는 싱글톤이 하나만 만들어지는 것을 보장하지 못한다.  
-싱글톤의 사용은 전역 상태를 만들 수 있기 때문에 바람직하지 못하다.  
  
싱글톤 레지스트리: 스프링은 직접 싱글톤 형태의 오브젝트를 만들고 관리하는 기능을 제공한다.  
  
#### 1.6.2 싱글톤과 오브젝트의 상태  
메소드 파라미터나, 메소드 안에서 생성되는 로컬 변수는 매번 새로운 값을 저장할 독립적인 공간이 만들어지기 때문에  
싱글톤이라고 해도 여러 스레드가 변수의 값을 덮어쓸 일은 없다.  
  
#### 1.6.3 스프링 빈의 스코프  
스프링 빈의 기본 스코프는 싱글톤이다.  
싱글톤 스코프는 컨테이너 내에 한 개의 오브젝트만 만들어져서, 강제로 제거하지 않는 한 스프링 컨테이너가 존재하는 동안 계속 유지된다.  
스프링에서 만들어지는 대부분의 빈은 싱글톤 스코프를 갖는다.  
  
  
### 1.7 의존관계 주입(DI)  
#### 1.7.1 제어의 역전(IoC)과 의존관계 주입  
DaoFactory처럼 객체를 생성하고 관계를 맺어주는 등의 작업을 담당하는 기능을 일반화한 것이 스프링의 IoC 컨테이너다.  
  
#### 1.7.2 런타임 의존관계 설정  
#### 1.7.3 의존관계 검색과 주입  
#### 1.7.4 의존관계 주입의 응용  
#### 1.7.5 메소드를 이용한 의존관계 주입  
  
  
### 1.8 XML을 이용한 설정  
XML은 단순한 텍스트 파일이기 때문에 다루기 쉽다.  
또, 쉽게 이해할 수 있으며 컴파일과 같은 별도의 빌드 작업이 없다는 것도 장점이다.  
  
#### 1.8.1 XML 설정  
#### 1.8.2 XML을 이용하는 애플리케이션 컨텍스트  
#### 1.8.3 DataSource 인터페이스로 변환  
#### 1.8.4 프로퍼티 값의 주입  
  
  
### 1.9 정리  
스프링이란 어떻게 오브젝트가 설계되고, 만들어지고, 어떻게 관계를 맺고 사용되는지에 관심을 갖는 프레임워크.  
  
  
## 참고  
https://github.com/choimung/toby-spring-3.1  
끝     